define(function(a,b,c){function d(){var a=e.defer(),b=e.defer();return{put:function(b){var c=e.defer();a.resolve({head:b,tail:c.promise}),a.resolve=c.resolve},get:function(){var c=a.promise.get("head");return a.promise=a.promise.get("tail"),c.fail(function(a){throw b.resolve(a),a})},closed:b.promise,close:function(c){c=c||new Error("Can't get value from closed queue");var d={head:e.reject(c)};return d.tail=d,a.resolve(d),b.promise}}}var e=a("./q");c.exports=d});